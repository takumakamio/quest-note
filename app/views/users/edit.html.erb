<div class='mypage'>
  <h2>My Page</h2>
  <%= render 'layouts/error_messages', resource: @user %>
  <%= form_with model: @user, url: user_path(@user), method: :patch, local:true do |f| %>
  <div class="profile-body">
    <div class="profile-detail">

      <div class="profile-icon">
  	    <label>
  	      <%= f.attachment_field :image, placeholder: "プロフィール画像" %>
  	    </label>
  	  </div>

      <div class='profile-basis'>
        <div class="form-group">
          <p>名前</p>
          <div><%= attachment_image_tag(@user, :image, :fill, 100, 100, fallback: "no-image-icon.jpg") %></div>
          <%= f.text_field :name, :placeholder =>"#{@user.name}", class:"form-control" %>
        </div>

        <div class="form-group">
          <p>メールアドレス</p>
          <%= f.email_field :email, autocomplete: "email", :placeholder =>"#{@user.email}", class:"form-control" %>
        </div>

        <div class="form-group">
          <p>introduction</p>
          <%= f.text_area :introduction, :placeholder =>"#{@user.introduction}", class:"form-control"  %>
        </div>

        <div>所属グループ数 : <%= @user.group_users.count %></div>
      </div>
    </div>

    <div class="profile-btn">
      <div class="btn">
        <%= hidden_field_tag :user_id, params[:user_id] %>
        <%= f.submit "保存",  class:"btn btn-secondary" %>
      </div>
    </div>
    <% end %>
  </div>


</div>

<script>
$(function(){
    // inputのidから情報の取得
    $('.profile-icon').on('change', function (e) {
// ここから既存の画像のurlの取得
    var reader = new FileReader();
    reader.onload = function (e) {
        $("img").attr('src', e.target.result);
    }
// ここまで
    reader.readAsDataURL(e.target.files[0]); //取得したurlにアップロード画像のurlを挿入
  });
});

</script>